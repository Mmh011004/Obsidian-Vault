# TIM 定时中断
定时器类型

| **类型** |         **编号**          | **总线** |                         功能                         |
| :----: | :---------------------: | :----: | :------------------------------------------------: |
| 高级定时器  |       TIM1, TIM8        |  APB2  |      拥有通用定时器全部功能，并额外具有重复计数器、死区生成、互补输出、刹车输入等功能      |
| 通用定时器  | TIM 2, TIM3, TIM4, TIM5 |  APB1  | 拥有基本定时器全部功能，并额外具有内外时钟源选择、输入捕获、输出比较、编码器接口、主从触发模式等功能 |
| 基本定时器  |       TIM6, TIM7        |  APB1  |                 拥有定时中断、主模式触发DAC的功能                 |
下图为**时钟树**：
![[Pasted image 20240417200026.png]]
## 基本定时器
![[Pasted image 20240416224632.png]]
基本定时器的时钟源只能是来自内部时钟，其中内部时钟是 72MHz。但是从时钟树的图可以看出SYSCLK = 72MHz，AHB = 72MHz，APB1 = 36MHz，但是APB1 的分频系数是 2，所以会将 36 * 2 还是得到72MHz。
基本定时器主要涉及的三个寄存器分别是计数器寄存器(TIMx_CNT)，预分频器寄存器 (TIMx_PSC)，自动重载寄存器 (TIMx_ARR)，这三个寄存器都是 **16**位有效数字，可以设置值为 0~65535。
### 计数器
计数器计数频率：
$$\mathrm{CK\_CNT=CK\_PSC/(PSC+1)}$$ 其中,CK_PSC 表示预分频器的时钟频率，PSC 为预分频值，如果 PSC=0，则不进行分频，PSC=1 则是二分频，以此类推。预分频值和实际的预分频系数相差 1，所以需要相加 1。后面的**计数器**每经过一个上升沿就进行+1 操作，当与**自动重载寄存器**的值相等时，产生中断信号，并且将计数器清零。
### 自动重载器
自动重载寄存器中存放的就是目标值，当计数器的值达到目标值时，生成中断信号。
## 通用定时器
![[Pasted image 20240417211122.png]]
## 定时中断基本结构
![[Pasted image 20240417211201.png]]
从图中可以看出在时基单元的时钟选择部分，也就是黄色之前